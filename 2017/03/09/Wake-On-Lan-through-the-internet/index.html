<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Wake-On-Lan through the internet | Dang's blog</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">Dang's blog</a><span class="subtitle">Where randomness is the king</span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a><a href="/CV/CV.html" class="sidebar-nav-item">CV</a><a href="/about" class="sidebar-nav-item">About</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>Wake-On-Lan through the internet</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2017-03-09</div><div class="post-tags"><a class="post-tag-link" href="/tags/Hobby/">Hobby</a>/<a class="post-tag-link" href="/tags/System-Configuration/">System Configuration</a></div></div></div><article><div class="container post"><link rel="stylesheet" href="/css/nikasa-style.css" type="text/css">

<p>My daily work usually starts by opening an SSH connection to a server, running a docker image (with RStudio Server or Jupyter on it), and analyzing data or programming directly on the browser. It was always convenient like that until I got sudden disconnection last month. Suddenly anything stops working, <a id="more"></a> and I wasted several hours hopelessly trying to fix it. When I went home, I figured out that the electricity in my apartment was very unstable due to a small construction upstairs. Of course, a simple solution is getting a UPS (Uninterruptible Power Supply), but I was fascinated by the idea that maybe I can turn on my server over the internet. That is like having the server’s power switch with me all the time. It would be so cool, especially when I’m away for an extended period and don’t want to waste money on the energy bills. This story is about how I’ve done it. You can have a look at my final network setup first.</p>
<p><figure><img class="img-medium" src="/images/WOL/WOL_diagram.png" alt="My Network with the Wifi Repeater to provide wired connection to the server, and an insider to help me wake the server through the internet"><figcaption class="image-caption">My Network with the Wifi Repeater to provide wired connection to the server, and an insider to help me wake the server through the internet</figcaption></figure></p>
<p><strong>Step 1</strong>: Satisfy hardware requirements</p>
<p>In most motherboards, there is a function called “Wake-on-Lan” (WOL). WoL works by sending a packet of data called a Magic Packet™ to a target machine. When the packet is received, the target machine’s network interface wakes-up the rest of the computer. However, I recognized that I cannot wake-up my server through its wireless interface (I’m using a USB wireless adapter). It turned out that the Magic Packet must be sent to the motherboard’s built-in Ethernet port since it’s the only thing awake when the whole machine off. I fixed the situation by using a <em>Wifi Repeater</em>, and connect it to the server through an Ethernet cable.<strong> You can skip this step if your machine is using a wired connection.</strong></p>
<p><strong>Step 2:</strong> Make Wake-On-Lan work on Lan.</p>
<p>As the name suggested, WOL is designed to wake-up a machine through a local network. So you have to be in the same network with your target device to make it work. In this step, we will try to do just that.<br>First, you have to turn on the WOL feature on your motherboard. Enter the BIOS setup and look for “ Wake up on PCI event” or “ Wake up on LAN” and enable it.</p>
<p>Second, on Ubuntu, you have to know your default interface, check if it supports WOL, and turn on the feature. The whole process can be done as following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker <span class="built_in">exec</span> -it <span class="variable">$DockerID</span> /bin/bash</div></pre></td></tr></table></figure>
<p>To make the setting sustains after rebooting, you need to add the last command above to the interface’s configuration in <em>etc/network/interfaces</em>. You can read more in <a href="https://help.ubuntu.com/community/WakeOnLan" target="_blank" rel="external">here</a>.<br>Now, let’s test it. You can use a mobile app called “Wake-on-Lan” in Android (there are similar apps for iOS, but I haven’t tested it). It can automatically scan your local network and list all of the connected devices. You just search for your machine, add it, and then you can send the magic packet to it whenever you want. Try to turn off your target machine and wake it up by your phone.<br>You can add the device manually if you know its mac address and broadcast address. They are <em>9E:65:F9:0E:29:FB</em> and <em>192.168.0.255</em> in my case. You can use the <em>ifconfig</em> command to find out that information. Note that you will need your mac address to wake up your machine through the internet.</p>
<p><strong>Step 3: </strong> Make Wake-On-Lan work through the internet.</p>
<p>Note that your router must have a static IP (e.g., <strong>82.164.3.27</strong>) to complete this step. There are many solutions to send the magic packet through the internet. I’ve listed them below from the easiest to the hardest (sometimes the only) solution:</p>
<p><strong>First solution</strong>: If your router supports forwarding the magic packet (Port 7 or 9 UDP), you are lucky. You can just forward any packet from port 7 or 9 UDP to your target device. Some routers even allow forwarding broadcast packet. You can use <a href="https://www.depicus.com/wake-on-lan/woli." target="_blank" rel="external">this website</a> to wake up your server. However, as far as I know, most of the popular commercial routers do not support this (my case). Remember to make a DHCP reservation for your server, so that its IP will not change after reconnecting.</p>
<p><strong>Second solution</strong>: You can check if you can install a better firmware for your router. For marketing purpose, many router producers hide functionalities on their products. You can install a third-party firmware to unlock all of these. I highly recommend the <a href="https://openwrt.org/" target="_blank" rel="external">OpenWrt</a>. Check if your router is supported by OpenWrt <a href="https://wiki.openwrt.org/toh/start" target="_blank" rel="external">here</a>.</p>
<p><strong>Third solution</strong>: If your router is not that good, you will need an insider. It’s a device that is always on and connects to your local network. Then you can SSH to your insider over the internet and let it send the magic package for you. In my case, I use a cheap Raspberry Pi 3 (which I already use for controlling other things). I’m using OpenWrt on it, and run the etherwake command as following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ etherwake 9E:65:F9:0E:29:FB eth0</div></pre></td></tr></table></figure>
<p>The first argument is the mac address of the target machine, while the second argument is the network interface of the insider that will send the package. It should be its default interface. You can check <a href="https://wiki.openwrt.org/doc/uci/wol" target="_blank" rel="external">this link</a> for more detail. Note that your insider can be any device, running any OS. As long as you can SSH to it through the internet, it should work. Remember to configure port forwarding for the insider’s SSH port, so that you can SSH to it from anywhere.</p>
<p>So, that’s it. I hope you enjoy the story. Leave a comment if you have any trouble following it.</p>
</div><!-- comment system--><div class="container"><hr><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'dangsblog';
var disqus_identifier = '2017/03/09/Wake-On-Lan-through-the-internet/';
var disqus_title = 'Wake-On-Lan through the internet';
var disqus_url = 'https://nikasa1889.github.io/2017/03/09/Wake-On-Lan-through-the-internet/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="mailto:nikasa.1889@gmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a><a href="https://github.com/https://github.com/Nikasa1889/" target="_blank"><i class="fa fa-github"></i></a><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2017 <a href="/" rel="nofollow">Dang Ha The Hien</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
e=o.createElement(i);r=o.getElementsByTagName(i)[0];
e.src='//www.google-analytics.com/analytics.js';
r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-86948407-1');ga('send','pageview');</script></html>